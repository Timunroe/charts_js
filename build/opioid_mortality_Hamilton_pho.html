<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Opioid-related morbidity and mortality rates</title>


    <style>
        .chart-container {
            position: relative;
            height: 500px;
            width: 100%;
            max-width: 800px;
        }
      canvas {
          -moz-user-select: none;
          -webkit-user-select: none;
          -ms-user-select: none;
      }
    </style>
</head>
<body>
    <div class="chart-container">
        <h3>Rates of opioid-related morbidity and mortality, 2003-2017</h3>
        <canvas id="myChart"></canvas>
        <p>Notes: Death data for 2017 should be considered as preliminary and is subject to change</p>
        <p>Source: <a href="https://www.publichealthontario.ca/en/dataandanalytics/pages/opioid.aspx">Public Health Ontario</a></p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
    
    <script>
        var region = 'Hamilton'
        var my_title = 'City of Hamilton Public Health'
        var my_data = {
           "Ontario": [
            {
                "Year": "2003",
                "Population": "12243758",
                "Rate of ED visits": "15.2",
                "Count of ED visits": "1858",
                "Rate of Hospitalizations": "9.7",
                "Count of Hospitalizations": "1188",
                "Rate of Deaths": "3.0",
                "Count of Deaths": "366"
            },
            {
                "Year": "2004",
                "Population": "12390068",
                "Rate of ED visits": "16.5",
                "Count of ED visits": "2043",
                "Rate of Hospitalizations": "10.3",
                "Count of Hospitalizations": "1275",
                "Rate of Deaths": "2.7",
                "Count of Deaths": "340"
            },
            {
                "Year": "2005",
                "Population": "12527990",
                "Rate of ED visits": "16.7",
                "Count of ED visits": "2086",
                "Rate of Hospitalizations": "10.6",
                "Count of Hospitalizations": "1323",
                "Rate of Deaths": "3.5",
                "Count of Deaths": "444"
            },
            {
                "Year": "2006",
                "Population": "12661566",
                "Rate of ED visits": "17.0",
                "Count of ED visits": "2150",
                "Rate of Hospitalizations": "9.7",
                "Count of Hospitalizations": "1232",
                "Rate of Deaths": "3.4",
                "Count of Deaths": "436"
            },
            {
                "Year": "2007",
                "Population": "12764195",
                "Rate of ED visits": "17.5",
                "Count of ED visits": "2231",
                "Rate of Hospitalizations": "9.7",
                "Count of Hospitalizations": "1239",
                "Rate of Deaths": "3.7",
                "Count of Deaths": "468"
            },
            {
                "Year": "2008",
                "Population": "12882625",
                "Rate of ED visits": "18.7",
                "Count of ED visits": "2411",
                "Rate of Hospitalizations": "10.2",
                "Count of Hospitalizations": "1316",
                "Rate of Deaths": "3.8",
                "Count of Deaths": "491"
            },
            {
                "Year": "2009",
                "Population": "12997687",
                "Rate of ED visits": "22.2",
                "Count of ED visits": "2886",
                "Rate of Hospitalizations": "11.2",
                "Count of Hospitalizations": "1450",
                "Rate of Deaths": "4.1",
                "Count of Deaths": "529"
            },
            {
                "Year": "2010",
                "Population": "13135063",
                "Rate of ED visits": "21.6",
                "Count of ED visits": "2841",
                "Rate of Hospitalizations": "10.9",
                "Count of Hospitalizations": "1435",
                "Rate of Deaths": "4.3",
                "Count of Deaths": "571"
            },
            {
                "Year": "2011",
                "Population": "13263544",
                "Rate of ED visits": "22.1",
                "Count of ED visits": "2934",
                "Rate of Hospitalizations": "12.1",
                "Count of Hospitalizations": "1605",
                "Rate of Deaths": "4.2",
                "Count of Deaths": "556"
            },
            {
                "Year": "2012",
                "Population": "13413702",
                "Rate of ED visits": "23.5",
                "Count of ED visits": "3154",
                "Rate of Hospitalizations": "13.2",
                "Count of Hospitalizations": "1775",
                "Rate of Deaths": "4.4",
                "Count of Deaths": "585"
            },
            {
                "Year": "2013",
                "Population": "13556229",
                "Rate of ED visits": "22.5",
                "Count of ED visits": "3051",
                "Rate of Hospitalizations": "12.3",
                "Count of Hospitalizations": "1671",
                "Rate of Deaths": "4.7",
                "Count of Deaths": "639"
            },
            {
                "Year": "2014",
                "Population": "13685171",
                "Rate of ED visits": "24.5",
                "Count of ED visits": "3347",
                "Rate of Hospitalizations": "12.5",
                "Count of Hospitalizations": "1706",
                "Rate of Deaths": "4.9",
                "Count of Deaths": "676"
            },
            {
                "Year": "2015",
                "Population": "13797038",
                "Rate of ED visits": "26.3",
                "Count of ED visits": "3628",
                "Rate of Hospitalizations": "12.6",
                "Count of Hospitalizations": "1745",
                "Rate of Deaths": "5.3",
                "Count of Deaths": "728"
            },
            {
                "Year": "2016",
                "Population": "13982984",
                "Rate of ED visits": "31.7",
                "Count of ED visits": "4427",
                "Rate of Hospitalizations": "13.7",
                "Count of Hospitalizations": "1909",
                "Rate of Deaths": "6.2",
                "Count of Deaths": "867"
            },
            {
                "Year": "2017",
                "Population": "14229571",
                "Rate of ED visits": "54.6",
                "Count of ED visits": "7764",
                "Rate of Hospitalizations": "15.1",
                "Count of Hospitalizations": "2142",
                "Rate of Deaths": "8.9",
                "Count of Deaths": "1265"
            }
        ],
        "Hamilton": [
            {
                "Year": "2003",
                "Population": "518751",
                "Rate of ED visits": "24.1",
                "Count of ED visits": "125",
                "Rate of Hospitalizations": "12.9",
                "Count of Hospitalizations": "67",
                "Rate of Deaths": null,
                "Count of Deaths": null
            },
            {
                "Year": "2004",
                "Population": "520992",
                "Rate of ED visits": "28.0",
                "Count of ED visits": "146",
                "Rate of Hospitalizations": "12.1",
                "Count of Hospitalizations": "63",
                "Rate of Deaths": null,
                "Count of Deaths": null
            },
            {
                "Year": "2005",
                "Population": "522469",
                "Rate of ED visits": "18.2",
                "Count of ED visits": "95",
                "Rate of Hospitalizations": "12.4",
                "Count of Hospitalizations": "65",
                "Rate of Deaths": "5.0",
                "Count of Deaths": "26"
            },
            {
                "Year": "2006",
                "Population": "523629",
                "Rate of ED visits": "19.7",
                "Count of ED visits": "103",
                "Rate of Hospitalizations": "9.7",
                "Count of Hospitalizations": "51",
                "Rate of Deaths": "4.0",
                "Count of Deaths": "21"
            },
            {
                "Year": "2007",
                "Population": "524002",
                "Rate of ED visits": "24.8",
                "Count of ED visits": "130",
                "Rate of Hospitalizations": "11.3",
                "Count of Hospitalizations": "59",
                "Rate of Deaths": "4.2",
                "Count of Deaths": "22"
            },
            {
                "Year": "2008",
                "Population": "525599",
                "Rate of ED visits": "26.1",
                "Count of ED visits": "137",
                "Rate of Hospitalizations": "16.0",
                "Count of Hospitalizations": "84",
                "Rate of Deaths": "4.8",
                "Count of Deaths": "25"
            },
            {
                "Year": "2009",
                "Population": "527652",
                "Rate of ED visits": "29.2",
                "Count of ED visits": "154",
                "Rate of Hospitalizations": "17.8",
                "Count of Hospitalizations": "94",
                "Rate of Deaths": "6.1",
                "Count of Deaths": "32"
            },
            {
                "Year": "2010",
                "Population": "531663",
                "Rate of ED visits": "27.6",
                "Count of ED visits": "147",
                "Rate of Hospitalizations": "15.2",
                "Count of Hospitalizations": "81",
                "Rate of Deaths": "7.1",
                "Count of Deaths": "38"
            },
            {
                "Year": "2011",
                "Population": "535602",
                "Rate of ED visits": "25.6",
                "Count of ED visits": "137",
                "Rate of Hospitalizations": "17.6",
                "Count of Hospitalizations": "94",
                "Rate of Deaths": "7.3",
                "Count of Deaths": "39"
            },
            {
                "Year": "2012",
                "Population": "540879",
                "Rate of ED visits": "31.8",
                "Count of ED visits": "172",
                "Rate of Hospitalizations": "21.6",
                "Count of Hospitalizations": "117",
                "Rate of Deaths": "6.8",
                "Count of Deaths": "37"
            },
            {
                "Year": "2013",
                "Population": "546301",
                "Rate of ED visits": "33.7",
                "Count of ED visits": "184",
                "Rate of Hospitalizations": "22.0",
                "Count of Hospitalizations": "120",
                "Rate of Deaths": "7.5",
                "Count of Deaths": "41"
            },
            {
                "Year": "2014",
                "Population": "551163",
                "Rate of ED visits": "39.4",
                "Count of ED visits": "217",
                "Rate of Hospitalizations": "23.6",
                "Count of Hospitalizations": "130",
                "Rate of Deaths": "6.7",
                "Count of Deaths": "37"
            },
            {
                "Year": "2015",
                "Population": "554996",
                "Rate of ED visits": "44.0",
                "Count of ED visits": "244",
                "Rate of Hospitalizations": "25.9",
                "Count of Hospitalizations": "144",
                "Rate of Deaths": "8.3",
                "Count of Deaths": "46"
            },
            {
                "Year": "2016",
                "Population": "561022",
                "Rate of ED visits": "52.9",
                "Count of ED visits": "297",
                "Rate of Hospitalizations": "24.1",
                "Count of Hospitalizations": "135",
                "Rate of Deaths": "9.3",
                "Count of Deaths": "52"
            },
            {
                "Year": "2017",
                "Population": "569908",
                "Rate of ED visits": "87.2",
                "Count of ED visits": "497",
                "Rate of Hospitalizations": "25.3",
                "Count of Hospitalizations": "144",
                "Rate of Deaths": "15.4",
                "Count of Deaths": "88"
            }
        ],
       };
        var YEARS = ["2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017"];
        // var Ontario_ED = Array.from(my_data[region], x => x['Rate of ED visits']);

    data = {
        labels: YEARS,
        datasets: [
            {
                label: "ED visits",
                data: Array.from(my_data[region], x => x['Rate of ED visits']),
                // data: ['15.2', '16.5', '16.7', '17.0', '17.5', '18.7', '22.2', '21.6', '22.1', '23.5', '22.5', '24.5', '26.3', '31.7', '54.6'],
                fill: false,
                borderColor: "rgb(102,0,153)",
                backgroundColor: "rgb(102,0,153)",
                lineTension: 0.1
            }, 
            {
                label: "Hospitalizations",
                data: Array.from(my_data[region], x => x['Rate of Hospitalizations']),
                fill: false,
                borderColor: "rgb(255,204,0)",
                backgroundColor: "rgb(255,204,0)",
                lineTension: 0.1
            }, 
            {
                label: "Deaths",
                data: Array.from(my_data[region], x => x['Rate of Deaths']),
                fill: false,
                borderColor: "rgb(0,102,51)",
                backgroundColor: "rgb(0,102,51)",
                lineTension: 0.1
            }, 
        ]
    }
        var ctx = document.getElementById("myChart").getContext('2d');
        var myLineChart = new Chart(ctx, {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                elements: {
                    point: {
                        radius: 5,
                        hitRadius: 3,
                    },
                },
				scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Year'
							}
						}],
					yAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Rate per 100,000'
						},
                        ticks: {
                            // suggestedMax: 100,
							//stepSize: 5
						}
					}]
				},
				title: {
					display: true,
					text: my_title,
				},
                tooltips: {
                    titleFontSize: 14,
                    bodyFontSize: 14,
                    xPadding: 10,
                    YPadding: 10,
                    caretSize: 8,
                    bodySpacing: 6,
                    callbacks: {
                        title: function(tooltipItems, data) {
                            var n, topic_list, topic, the_index, cases, population
                            n = (tooltipItems[0].datasetIndex).toString();
                            topic_list = {
                                "0": "ED Visits",
                                "1": "Hospitalizations",
                                "2": "Deaths"
                            };
                            topic = topic_list[n]
                            //alert(tooltipItems[0].datasetIndex)
                            return topic + "\r\n" + tooltipItems[0].xLabel;
                        },
                        afterBody: function(tooltipItems, data) {
                            the_index = tooltipItems[0].index
                            population = my_data[region][the_index]['Population'].replace(/\B(?=(\d{3})+(?!\d))/g, ",")
                            if (tooltipItems[0].datasetIndex == 0) {
                                cases = my_data[region][the_index]['Count of ED visits'].replace(/\B(?=(\d{3})+(?!\d))/g, ",")
                            } else if (tooltipItems[0].datasetIndex == 1) {
                                cases = my_data[region][the_index]['Count of Hospitalizations'].replace(/\B(?=(\d{3})+(?!\d))/g, ",")
                            } else {
                                cases = my_data[region][the_index]['Count of Deaths'].replace(/\B(?=(\d{3})+(?!\d))/g, ",")
                            }
                            return "Cases: " +  cases + "\r\n" + "Population: " +  population;
                        },
                        label: function(tooltipItems, data) {
                            return " Rate per 100,000: " + tooltipItems.yLabel;
                        }
                    },
                },
			}
        });
        </script>
</body>
</html>
